<!DOCTYPE html>
<html><head>
    
    
        
    
    <title>
        code.zoia.org
    </title>
    
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.91.2" />
     <meta property="og:title" content="code.zoia.org" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://code.zoia.org/" />


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href='/css/styles.css'>
    <link rel="stylesheet" type="text/css" href='/css/syntax.css'>
</head>
<body>
        <div class="container max-w-screen-md mx-auto"><header class="container subpixel-antialiased">
    <nav class="flex flex-wrap w-full py-4 md:py-0 text-lg text-gray-70 bg-white">
        <ul class="text-base
                   text-gray-300
                   pt-4
                   md:flex
                   md:pt-0
                   sans-serif
                   uppercase
                   "
        >
            <li class="md:pt-3
                py-2
                block"><span class="
                                    font-medium
                                    text-lg
                                    text-gray-500"
                       >code</span><span
                            class="font-medium
                                   text-logoleft
                                   text-lg"
                        >zoia</span><span
                             class="
                                    text-lg
                                    font-medium
                                    text-gray-500"
                       >org</span></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/about/">About</a></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/archive/">Archive</a></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/">Home</a></li>
            

        </ul>
    </nav>
</header>
</div>
        <div class="content container max-w-screen-md mx-auto mt-8 pb-16">

    
        <article class="pb-4 mb-12 border-b">
            <div><h2 class="text-3xl font-sans font-normal"><a href="https://code.zoia.org/post/calibre-drm-tools-and-kindle-on-linux/">How to use Calibre with DeDRM tools on Linux to backup your Kindle library</a></h2></div>
            <div class="text-sm text-gray-500">September 19, 2020</div>
            <div class="mt-3 font-sans font-light text-gray-900">
                <p>Amazon Kindle&rsquo;s ecosystem lets you buy an ebook and begin reading seconds after purchasing it. However, as most of Amazon&rsquo;s book are DRM-protected, you cannot make a backup of your library or convert your booksÂ´ format to read them on another platform. Companies come and go, and even if Amazon&rsquo;s is here for the long run, it&rsquo;s policies regarding how you can access the content your paid for may change in the future.</p>
<p>Using a Kindle app version prior to 1.26 On Windows or MacOs, you can use Calibre with Aprentice Alf&rsquo;s DeDRM plugin to convert the books from your Kindle app on your computer to a DRM-free format. The plugin automatically extracts the necessary key the Kindle app uses to encrypt your books and makes the process transparent.</p>
<p>On Linux, you can use Wine to install the Kindle app. However, the DeDRM plugin doesn&rsquo;t extract the decryption key automatically.  To extract the key, you need to install Python and PyCrypto in Wine and run <code>kindlekey.py</code> manually. Once you have the key, you can import it into Calibre using the DeDRM plugin.</p>
<p>I&rsquo;ve tested the setup using Ubuntu 20.04.</p>
<ol>
<li>
<p>Install <a href="https://calibre-ebook.com/">Calibre</a> for Linux.</p>
</li>
<li>
<p>Download <a href="https://apprenticealf.wordpress.com/">Aprentice Alf&rsquo;s DeDRM tools</a>. Uncompress the file, open Calibre and install the DeDRM plugin.</p>
</li>
<li>
<p>Uncompress the DeDRM plugin file (<code>DeDRM_Plugin.zip</code>) and verify that there&rsquo;s a file named <code>kindlekey.py</code>.</p>
</li>
<li>
<p>Install <code>wine</code>:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dpkg --add-architecture i386
$ sudo apt update
$ sudo apt install wine64 wine32
<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>
$ wine --version
wine-5.0 <span style="color:#f92672">(</span>Ubuntu 5.0-3ubuntu1<span style="color:#f92672">)</span>
</code></pre></div><ol start="5">
<li>Search on Google for the  Kindle app for Windows. You need version 1.26 or <strong>earlier</strong>. Install it using wine:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wine kindleforpc-installer-1.15.43061.exe
</code></pre></div><p>Run the Kindle app and register it with your Amazon account. You should be able to access your Kindle library without problems.</p>
<ol start="6">
<li>Download the most recent version of Python 2.7 <strong>for Windows</strong> from <a href="https://www.python.org/downloads/">Python.org</a>. Install it using wine:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wine msiexec /i python-2.7.18.msi
</code></pre></div><ol start="7">
<li>Download a <a href="http://www.voidspace.org.uk/python/modules.shtml#pycrypto">Windows installer for PyCrypto</a> for Python 2.7. Install it using wine. (If you installed a 32-bit version of Python, use a 32-bit version of Pycrypto.)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wine pycrypto-2.6.win32-py2.7.exe
</code></pre></div><ol start="8">
<li>In the Linux terminal, naviagate to the folder where your <code>kindlekey.py</code> file resides. Then open a Windows shell using wine, and run kindlekey.py:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~/Downloads/DeDRM/original/DeDRM_tools_6.8.0/DeDRM_Plugin$ wine cmd.exe
Microsoft Windows 6.1.7601

D:<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span> <span style="color:#ae81ff">\D</span>eDRM_Plugin&gt;python kindlekey.py
Using Library AlfCrypto DLL/DYLIB/SO
searching <span style="color:#66d9ef">for</span> kinfoFiles in C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\(</span>...<span style="color:#f92672">)</span><span style="color:#ae81ff">\L</span>ocal Settings<span style="color:#ae81ff">\A</span>pplication Data
Found K4PC 1.9+ kinf2011 file: C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\(</span>...<span style="color:#f92672">)</span><span style="color:#ae81ff">\L</span>ocal Settings<span style="color:#ae81ff">\A</span>pplication Data<span style="color:#ae81ff">\A</span>mazon<span style="color:#ae81ff">\K</span>indle<span style="color:#ae81ff">\s</span>torage<span style="color:#ae81ff">\.</span>kinf2011
Decrypted key file using IDString <span style="color:#e6db74">&#39;0&#39;</span> and UserName <span style="color:#e6db74">&#39;xxxxxxxxxx&#39;</span>

D:<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span> <span style="color:#ae81ff">\D</span>eDRM_Plugin&gt; exit
</code></pre></div><ol start="9">
<li>
<p>You should now have a file named <code>kindlekey1.k4i</code> in your directory. Open Calibre, click on the Preferences button. Navigate to Plugins/File Type. Locate the DeDRM plugin, and click the &lsquo;Customize Plugin&rsquo; button and then click on <code>Kindle for Mac/PC ebooks</code>. Import the key into the DeDRM plugin and restart Calibre.</p>
</li>
<li>
<p>Locate your books inside the wine installation.  Wine stores the Windows installation under <code>~/.wine</code>. The Kindle books are usually located in <code>~/.wine/drive_c/users/[your username]/My Documents/My Kindle Content</code>.` I suggest you create a link to your Linux home directory.</p>
</li>
</ol>
<p>You can now import books from your Kindle directory into Calibre, and make a DRM-free backup copy.</p>
<p><em>Disclaimer</em>:  This instructions are intended for making a backup copy of your Kindle library, my intention is not to encourage piracy in any way.</p>

            </div>
        </article>
        

    
        <article class="pb-4 mb-12 border-b">
            <div><h2 class="text-3xl font-sans font-normal"><a href="https://code.zoia.org/post/migrating-from-pelican-to-hugo/">Migrating from Pelican to Hugo</a></h2></div>
            <div class="text-sm text-gray-500">August 16, 2020</div>
            <div class="mt-3 font-sans font-light text-gray-900">
                <p>I&rsquo;ve migrated this blog from <a href="https://getpelican.com/">Pelican</a> to <a href="https://gohugo.io/">Hugo</a>.</p>
<p>This blog has always been a static/baked blog. Content is just a collection of html files which reside in a Linode instance.  This allows me to use a very minimal server instance to host it.  Dynamic content generators like <a href="https://wordpress.org">Wordpress</a> generate content by extracting the articles from a database and producing a webpage on the fly, they allow for more complex setups, but also have a higher footprint.</p>
<p>The problem with Pelican is that once in a while, when I upgraded the software, my site configuration file broke. So instead of just publishing a new post, I had to spend time figuring out what had changed, testing the new configuration, etc. After evaluating some alternatives, I decided to give Hugo a try. It took me one morning to figure out Hugo, have a test site running on my laptop, move my posts to Hugo, and republish the blog on my server.</p>
<p>For the actual migration, I wrote a script in Python called <a href="https://github.com/robertozoia/pelican-to-hugo">pelican-to-hugo</a> that collects all the Markdown files from my blog&rsquo;s  Pelican directory, and converts each post&rsquo;s header to Hugo&rsquo;s front matter in TOML format. You can modify the script to suit your needs.</p>
<p>Some issues with the migration:</p>
<ul>
<li>
<p>I broke my urls in the migration.  I previously used dates as part of the post&rsquo;s path (i.e., <code>https://code.zoia.org/2020/08/migrating-from-pelican-to-hugo/</code>), now I&rsquo;m simply using `/posts/migrating-from-pelican-to-hugo/**.  I could write some code for the webserver to handle the redirection&hellip;</p>
<p><strong>Update 2020-08-23</strong>: Fixed the posts urls by duplicating the content under the original file structure.</p>
</li>
<li>
<p>I fixed my internal image links by hand: searching in the post&rsquo;s directory for images, and changing the path.  I did this by hand instead of writting code to do it because I don&rsquo;t use that many images in my posts.</p>
</li>
</ul>
<p>For know, I&rsquo;m using a nice theme from <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Djordje Atlialp</a> while I figure out how templates work in Hugo.</p>

            </div>
        </article>
        

    

    
        <article class="pb-4 mb-12 border-b">
            <div><h2 class="text-3xl font-sans font-normal"><a href="https://code.zoia.org/post/2020/how-to-create-a-windows-10-bootable-usb-on-macos/">How to create a Windows 10 bootable USB on MacOS</a></h2></div>
            <div class="text-sm text-gray-500">August 2, 2020</div>
            <div class="mt-3 font-sans font-light text-gray-900">
                <p>You donât need Unetbootin, MacOSâ Boot Camp, or Rufus for Windows to create a Windows 10 USB bootable drive on a Mac to install Windows on a PC.</p>
<p>I needed to install Windows 10 in a new custom-build PC. I donât have a single machine running Windows at home, so using Windows to create the bootable installer was out of the question.  I tried most of the recommended methods, but after booting from the USB drive and partitioning the disk of the new machine, the Windows installer always complained that it couldnât find some files it needed for the installation.</p>
<p>Finally, I found the culprit on <a href="https://apple.stackexchange.com/questions/355930/how-to-create-a-windows-10-bootable-usb-on-a-mac-for-pc-without-bootcamp-when-i">Stack Exchange</a>.  The Windows installer ISO image contains a file named <code>install.wim</code>, which is over 4G bytes long.  The USB drive is formatted as FAT32, which cannot hold files over 4G.  So, although youâll find a file named <code>install.wim</code> on the USB drive after creating the installer, the file is corrupted and the installation fails.</p>
<p>The workaround is to <em>compress</em> the  <code>install.wim</code> file on your Mac and copy the compressed file, which is around 1GB smaller, to the USB drive.  After that, the Windows installer finishes without complain.</p>
<ol>
<li>
<p>Download Windows 10 as an ISO image from <a href="https://www.microsoft.com/en-us/software-download/windows10ISO">Microsoft</a>.</p>
</li>
<li>
<p>Youâll need an USB  drive with at least 5G of space. Using MacOSâs Disk Util, format the USB to ExFAT or FAT (The exact format is not important for the Windows installer, but if your mainboard is not new  the mainboard of the computer you are installing to can read the USB drive).  Be sure to create boot partition (MBR) while formatting. Youâll need to select âShow all devicesâ using the upper left button in Disk Util so you can select the whole device for formatting, and not only the available partition.</p>
</li>
</ol>
<p><img src="/media/2020/diskutil.png" alt=""></p>
<ol start="3">
<li>Install <code>wimlib</code> on MacOS using <a href="https://brew.sh/">homebrew</a>:</li>
</ol>
<p><code>$ brew install wimlib</code></p>
<ol start="4">
<li>
<p>Double-click on the ISO file to mount it.</p>
</li>
<li>
<p>Select all files in the now-mounted ISO image and them to the USB drive.  Depending on the speed of your USB drive, this may take 20 minutes or more.</p>
</li>
<li>
<p>In the mounted ISO image, go to the <code>sources</code> directory, and copy <code>install.wim</code> to a folder on your Mac. (You cannot compress it directly inside the ISO image.)</p>
</li>
<li>
<p>From the terminal, in the folder you just copied <code>install.wim</code> to, use <code>wimlib</code> to compress the file. Compressing the file will take a long time, probably more than an hour.</p>
</li>
</ol>
<p><code>$ sudo wimlib-imagex optimize install.wim --solid</code></p>
<ol start="8">
<li>Open the <code>sources</code> directory in the USB drive and <strong>delete</strong> the <code>install.wim</code> file.</li>
<li>Copy your compressed <code>install.wim</code> file to the <code>sources</code> directory on the USB drive.</li>
<li>Unmount the USB drive.</li>
</ol>
<p>And thatâs it!  You now have a working Windows 10 installer created on MacOS.</p>

            </div>
        </article>
        

    
    
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/2/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/" aria-label="Page 1" class="page-link" role="button">1</a>
      </li>
      <li class="page-item">
        <a href="/page/2/" aria-label="Page 2" class="page-link" role="button">2</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 3" class="page-link" role="button">3</a>
      </li>
      <li class="page-item">
        <a href="/page/4/" aria-label="Page 4" class="page-link" role="button">4</a>
      </li>
      <li class="page-item">
        <a href="/page/5/" aria-label="Page 5" class="page-link" role="button">5</a>
      </li>
      <li class="page-item">
        <a href="/page/4/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/23/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>

        </div>
        <footer class="footer fixed inset-x-0 bottom-0 w-full bg-black text-gray-100 text-sm">
    <div class="container max-w-screen-md mx-auto pt-4 py-4">
        The footer.
    </div>
</footer>

    </body>
</html>
