<!DOCTYPE html>
<html><head>
    
    
    <title>
        Configuring Pelican, Dropbox, and automatic blog publishing
    </title>
    
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.91.2" />
     <meta property="og:title" content="Configuring Pelican, Dropbox, and automatic blog publishing" />
<meta property="og:description" content="In this post I will explain how I set up Pelican on a Linux (Ubuntu) server to mantain multiple blogs, using Dropbox for file synchronization, watcher to detect changes in the blog&rsquo;s content and regenerate it , and Apache to serve the resulting files.
 The blogs&rsquo;s content will reside in a shared Dropbox folder. This is where posts are written in Markdown format (or .rst if you prefer). Pelican template (themes) files will also reside in this Dropbox folder, so you can modifiy your blog&rsquo;s theme if needed without logging into your web server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.zoia.org/post/2014/02/pelican-dropbox-automatic-blog-regeneration/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2014-02-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2014-02-25T00:00:00+00:00" />


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href='/css/styles.css'>
    <link rel="stylesheet" type="text/css" href='/css/syntax.css'>
</head>
<body>
        <div class="container max-w-screen-md mx-auto"><header class="container subpixel-antialiased">
    <nav class="flex flex-wrap w-full py-4 md:py-0 text-lg text-gray-70 bg-white">
        <ul class="text-base
                   text-gray-300
                   pt-4
                   md:flex
                   md:pt-0
                   sans-serif
                   uppercase
                   "
        >
            <li class="md:pt-3
                py-2
                block"><span class="
                                    font-medium
                                    text-lg
                                    text-gray-500"
                       >code</span><span
                            class="font-medium
                                   text-logoleft
                                   text-lg"
                        >zoia</span><span
                             class="
                                    text-lg
                                    font-medium
                                    text-gray-500"
                       >org</span></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/about/">About</a></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/archive/">Archive</a></li>
            
                <li><a class="text-sm md:p-4 py-2 block hover:underline" href="/">Home</a></li>
            

        </ul>
    </nav>
</header>
</div>
        <div class="content container max-w-screen-md mx-auto mt-8 pb-16">
    <article class="pb-4 mb-10">
        <header class="border-b">
            <h1 class="text-3xl font-sans font-normal">Configuring Pelican, Dropbox, and automatic blog publishing</h1>
            <div class="text-sm text-gray-500">
    <time datetime='2014-02-25'>
        February 25, 2014
    </time>

    
        
        <a class="" href="https://code.zoia.org/tags/pelican">pelican</a>
        
        
        <a class="" href="https://code.zoia.org/tags/dropbox">dropbox</a>
        
        
        <a class="" href="https://code.zoia.org/tags/apache">apache</a>
        
        
        <a class="" href="https://code.zoia.org/tags/watcher">watcher</a>
        
        
        <a class="" href="https://code.zoia.org/tags/python">python</a>
        
        
        <a class="" href="https://code.zoia.org/tags/blogging">blogging</a>
        
        
        <a class="" href="https://code.zoia.org/tags/baked-blogs">baked blogs</a>
        
        
        <a class="" href="https://code.zoia.org/tags/static-blogs">static blogs</a>
        
   
</div>

        </header>
        <div class="mt-3 font-sans font-light text-gray-900">
            <p>In this post I will explain how I set up <a href="http:docs.getpelican.com">Pelican</a> on a Linux (Ubuntu) server to mantain multiple blogs, using Dropbox for file synchronization, <code>watcher</code> to detect changes in the blog&rsquo;s content and regenerate it , and Apache to serve the resulting files.</p>
<ul>
<li>The blogs&rsquo;s content will reside in a shared Dropbox folder. This is where posts are written in Markdown format (or .rst if you prefer).</li>
<li>Pelican template (themes) files will also reside in this Dropbox folder, so you can modifiy your blog&rsquo;s theme if needed without logging into your web server.</li>
<li>Pelican will run on your webserver, not on your local machine. (Don&rsquo;t need to call Pelican from your command line anymore.)  This way, you can publish content from wherever you have access to your Dropbox account and a text editor. Pelican will only launch when there is new content to be published, thus minimizing your server&rsquo;s load.</li>
<li>Each blog  will have custom its own <code>pelicanconf.py</code> and <code>publishconf.py</code> files.</li>
<li>A simple bash script for each blog will call <code>pelican</code> with the appropiate configuration files, input and output directories.</li>
<li><code>watcher</code>, a Python utility which uses the <code>inotify</code> interface, will monitor this shared folder for changes. (The difference between <code>watcher</code> and other similar utilities like <code>incron</code> is that <code>watcher</code> can detect changes in subdirectories, a trick <code>incron</code> cannot do directly.)</li>
</ul>
<h3 id="install-pelican">Install Pelican</h3>
<p>(I assume you have <code>virtualenv</code> and <code>virtualenvwrapper</code> installed.  If not, you can find information on how to do it <a href="http://stackoverflow.com/questions/4324558/whats-the-proper-way-to-install-pip-virtualenv-and-distribute-for-python">here</a> and <a href="http://www.virtualenv.org/en/latest/virtualenv.html">here</a>.)</p>
<p>Create a new virtual environment on your server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkvirtualenv pelican
</code></pre></div><p>Install Pelican in your virutalenv using <code>pip</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ pip install pelican
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ pip install markdown
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ pip install typogrify
</code></pre></div><h3 id="install-dropbox-cli-on-your-web-server">Install Dropbox CLI on your web server</h3>
<p>For security reasons, it is better to create a new Dropbox account for your blogs and share a folder in that account with your main Dropbox account.  This way you don&rsquo;t have to sync your whole Dropbox folder to your web server.</p>
<p>Logout from your Dropbox account on your browser and create the new Dropbox account.  Using Dropbox&rsquo;s web interface, create a folder for your blogs (let&rsquo;s call it <code>blog</code>). Share this folder with your main Dropbox account.</p>
<p>Install the Linux <a href="https://www.dropbox.com/install?os=linux">Dropbox command line client</a>.  Then run the Dropbox daemon from  your Linux&rsquo;s server command line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ ~/.dropbox-dist/dropboxd
</code></pre></div><p>The first time you run the daemon, it will ask you to visit a link on your browser so that Dropbox links your web server to your new account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">This client is not linked to any account...
Please visit https://www.dropbox.com/cli_link?host_id<span style="color:#f92672">=</span>xxxxxxxxxxx
</code></pre></div><p>Copy the link and paste it on your browser. (You must be logged to Dropbox with your newly created account for this to work.) Once this is done, Dropbox will take care of syncing your shared folder on your server.</p>
<h3 id="configure-pelican">Configure Pelican</h3>
<p>Create a new pelican blog using <code>pelican-quickstart</code>, as explained in the <a href="http://docs.getpelican.com/en/3.3.0/getting_started.html#kickstart-your-site">Pelican documentation</a>. (I won&rsquo;t cover how to configure Pelican here.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ pelican-quickstart
</code></pre></div><p>Once finished, you will have a directory named <code>pelican</code> with the necessary files to run your blog.</p>
<p>Optional: download a bunch of Pelican themes from github to your blog&rsquo;s directory in Dropbox. (We will assume that your themes reside in <code>~/Dropbox/blog/pelican-themes/</code>.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ git clone --recursive https://github.com/getpelican/pelican-themes ~/Dropbox/blog/pelican-themes
</code></pre></div><p>Copy the newly created <code>pelicanconf.py</code> and <code>publishconf.py</code> to create a custom version for your blog. (<code>example.com</code> for our purposes.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ cp pelicanconf.py examplecom_conf.py
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ cp publishconf.py publish_examplecom.py
</code></pre></div><p>Configure your Pelican blog as usual by modifying these new files.</p>
<p>We need to tell Pelican where to find your theme.  Add your theme&rsquo;s path to your <code>examplecom_conf.py</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Tell pelican your theme is in your Dropbox folder:</span>
THEME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/home/user/Dropbox/blog/pelican-themes/pelican-elegant&#39;</span>
</code></pre></div><p>As generated by <code>pelican-quickstart</code>, <code>publishconf.py</code> will work as is if you run Pelican from your <code>/home/user/pelican</code> directory.   But if you run Pelican from other directory, it will fail to import the <code>pelicanconf.py</code> settings because it won&rsquo;t find the file in the Python path.</p>
<p>To fix this, change <code>publish_examplecom.py</code> so that pelican modules are imported correctly when <code>watcher</code> runs the pelican script. Also, change the <code>from pelicanconf import *</code> statement to reflect your configuration&rsquo;s file name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> sys

<span style="color:#75715e">#sys.path.append(os.curdir)</span>
<span style="color:#75715e"># This is the directory where your pelican&#39;s</span>
<span style="color:#75715e"># configuration files reside</span>
pelicanpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/home/user/pelican&#39;</span>
sys<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>append(pelicanpath)

<span style="color:#75715e"># Change this import to reflect your blog&#39;s configuration</span>
<span style="color:#75715e"># from pelicanconf import *</span>
<span style="color:#f92672">from</span> examplecom_conf <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

SITEURL <span style="color:#f92672">=</span> <span style="color:#f92672">...</span>
</code></pre></div><p>Create a <code>bash</code> script in your <code>/home/user/pelican</code> directory that calls Pelican to regenerate the blog.  Name it something like <code>update_examplecom.sh</code>.   (Use <code>which</code> to determine where the <code>pelican</code> executable resides.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ which pelican
/home/user/.virtualenvs/pelican/bin/pelican
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
PELICAN<span style="color:#f92672">=</span>/home/user/.virtualenvs/pelican/bin/pelican
CONTENT<span style="color:#f92672">=</span>/home/user/Dropbox/blog/example.com/content/
OUTPUT<span style="color:#f92672">=</span>/home/user/example.com/www
SETTINGS<span style="color:#f92672">=</span>/home/user/pelican/publish-examplecom.py

$PELICAN $CONTENT -o $OUTPUT -s $SETTINGS
</code></pre></div><p>Make the script executable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ chmod +x update_examplecom.sh
</code></pre></div><p>To create additional blogs, there is no need to run <code>pelican-quickstart</code> again.  Just create new copies of <code>pelicanconf.py</code> and <code>publishconf.py</code>, and an appropriate bash script.</p>
<h3 id="apache">Apache</h3>
<p>The blog will be served as by Apache using virtual hosting.</p>
<p>Create the directory that will host your website.  (I prefer to have my websites in my user&rsquo;s home directory, instead of under <code>/var/www</code>.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ sudo mkdir -p ~/example.com/www
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ sudo mkdir -p ~/example.com/logs
</code></pre></div><p>Create the Apache&rsquo;s virtual host configuration file for your blog in <code>/etc/apache2/sites-available</code>. (For this example, <code>examplecom</code>).</p>
<pre tabindex="0"><code>&lt;VirtualHost *:80&gt;
ServerAdmin     info@example.com
ServerName      example.com
ServerAlias     www.example.com
DocumentRoot    /home/user/example.com/www/
ErrorLog        /home/user/example.com/logs/error.log
CustomLog       /home/user/example.com/logs/access.log combined

&lt;Directory /&gt;
Options Indexes FollowSymLinks MultiViews
AllowOverride All
Order allow,deny
allow from all
&lt;/Directory&gt;

&lt;/VirtualHost&gt;
</code></pre><p>Enable your new virtual domain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ sudo a2ensite examplecom
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ sudo service apache2 reload
</code></pre></div><h3 id="some-testing">Some testing</h3>
<p>Take a moment to test your configuration.  Create a sample post in <code>~/Dropbox/blog/example.com/content/posts</code> using your favorite editor in your laptop (not directly on your server), and run<code>update_examplecom.sh</code> on your server.  If everything goes right, you should be able to access your virtualhost at your domain.</p>
<h3 id="using-watcher-to-regenerate-the-blog-automatically">Using watcher to regenerate the blog automatically</h3>
<p><code>Watcher</code> is a nifty utility written in Python that monitors a directory and its subdirectories for change using the <code>inotify</code> interface.  It can be configured to execute a command when a change is detected, which is just what we need to regenerate our blog.</p>
<p>We will use a <a href="https://github.com/splitbrain/Watcher">forked Watcher</a> version that reads its configuration file from a Python-like .ini file instead of watcher&rsquo;s original YAML file.</p>
<p>Install <code>watcher</code>&rsquo;s dependencies.  Get <code>watcher</code> from <a href="http://github.com/splitbrain/Watcher">Github</a>, unzip the archive and copy <code>watcher.py</code> and <code>watcher.ini</code> to <code>/home/user/pelican</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Install watcher dependencies</span>
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ pip install pyinotify
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ wget https://github.com/splitbrain/Watcher/archive/master.zip
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ unzip master.zip
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ cp Watcher-master/watcher.* ~/pelican
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ chmod +x ~/pelican/watcher.py
</code></pre></div><p>Next, create a new job for your blog in <code>watcher.ini</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[job1]
watch<span style="color:#f92672">=/</span>home<span style="color:#f92672">/</span>user<span style="color:#f92672">/</span>Dropbox<span style="color:#f92672">/</span>blog<span style="color:#f92672">/</span>example<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>content
events<span style="color:#f92672">=</span>create,delete,modify,move
excluded<span style="color:#f92672">=</span>
recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
autoadd<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
command<span style="color:#f92672">=/</span>home<span style="color:#f92672">/</span>user<span style="color:#f92672">/</span>pelican<span style="color:#f92672">/</span>update_examplecom<span style="color:#f92672">.</span>sh
</code></pre></div><p>Start watcher:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ cd ~/pelican
<span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ ./watcher -c watcher.ini start
</code></pre></div><p>Monitor <code>watcher</code>&rsquo;s output to see if everything is working fine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ tail -f /tmp/watcher.log
</code></pre></div><p>Create or modify another sample post on your blog.  When you hit &lsquo;save&rsquo; on your editor, it will take a few seconds for Dropbox to syncronize your post with your web server.  <code>watcher</code> should notice the change and launch <code>update_examplecom.sh</code>.  You should see something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>pelican<span style="color:#f92672">)</span> $ tail -f /tmp/watcher.log
Done: Processed <span style="color:#ae81ff">15</span> articles and <span style="color:#ae81ff">1</span> pages in 1.21 seconds.
</code></pre></div><h3 id="configuring-additional-blogs">Configuring additional blogs</h3>
<p>You can configure Pelican to maintain aditional blogs easily:</p>
<ul>
<li>create new Pelican configuration files and a regeneration script for each blog.</li>
<li>add a virtual host for the domain.</li>
<li>add a new job to <code>watcher</code>&rsquo;s .ini file and restart <code>watcher</code>.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>Pelican is fast, even if it regenerates the whole blog every time.  This setup enables you to blog from anywhere you can access your Dropbox account and a text editor.  (In fact, most of this article was written using <em>Editorial</em> on my iPad.)</p>

        </div>
    </article>


        </div>
        <footer class="footer fixed inset-x-0 bottom-0 w-full bg-black text-gray-100 text-sm">
    <div class="container max-w-screen-md mx-auto pt-4 py-4">
        The footer.
    </div>
</footer>

    </body>
</html>
